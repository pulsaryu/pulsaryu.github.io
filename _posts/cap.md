---
layout: post
title: 分布式系统 CAP 原则
category: 架构
tags: [分布式, 架构]
---

分布式系统 CAP 原则
=======

## CAP

CAP 是Consistency、Availability和Partition tolerance 的缩写。分别代表了3个分布式系统的3个指标。

- Consistency 原子性：写入和读取服务集群是原子的。
- Availability 可用性：读取可能会读到旧的值。
- Partition tolerance 分区容错性：部分服务不可用的情况下任然可以提供服务，在分布式系统中，分区容错是必备的。

## 不相容原理
CAP 3个指标中，最多只能实现其中两个，不可能3个都实现。因为目前P是我们必须要实现的，所以具体就是要么实现CP，要么就是AP，没有其他。

## 解决什么问题？
在设计任何分布式系统的时候，必须要考虑CAP原则，我们必须要选择一种模式，具体是CP和AP必须选择其中之一。CP和AP本质上没有优劣之分，需要根据实际场景进行选择。


## AP 适用场景

Eureka 实现的AP，所以可能会出现连接不同的 Eureka 服务的情况下获取到不同的值。
CDN 实现的也是AP，在不同的节点上，可能获取到不同的版本数据。当原始数据更新后，通常需要通知CDN的各个节点去重新拉去原始数据，但是这个需要一个过程，在这个过程中，就会出现外部从各个CDN节点获取到的数据不一致的情况，但通常我们允许这样的情况出现。

## CP 适用场景

ZooKeeper 实现的CP。ZooKeeper 可以保证任何时候获取到的数据都是最新的。
银行转账服务 也需要实现的CP场景。在转账场景中，我们绝不允许用户看到已经无效的金额。
